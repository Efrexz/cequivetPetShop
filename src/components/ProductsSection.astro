---
import CardProduct from "@components/CardProduct.astro";
import SearchIcon from "@assets/icons/search.svg";

const { title, titleHighlight, description, filterOptions, products } =
  Astro.props;
---

<section class="bg-gradient-to-br from-emerald-50 to-orange-50 py-12 lg:py-16">
  <div class="container mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center max-w-3xl mx-auto mb-12 fade-in-up" data-animate>
      <h1
        class="text-4xl sm:text-5xl font-extrabold text-[#00BD9D] mb-4 drop-shadow-sm"
      >
        {title}
        <span class="text-[#FF7F11]">{titleHighlight}</span>
      </h1>
      <p class="text-lg text-gray-700 leading-relaxed">
        {description}
      </p>
    </div>

    <!-- Filtros y Búsqueda -->
    <div
      class="bg-white px-6 py-4 rounded-3xl shadow-xl hover:shadow-2xl transition-all duration-300 mb-12 flex flex-col lg:flex-row items-center justify-between gap-6 border-b-4 border-[#00BD9D]/60 fade-in-up"
      data-animate
      style="transition-delay: 0.2s;"
    >
      <div class="relative w-full lg:w-1/3">
        <input
          type="text"
          id="searchInput"
          placeholder="Buscar productos..."
          class="w-full pl-12 pr-4 py-3 rounded-full border-2 border-gray-200 focus:outline-none focus:ring-4 focus:ring-[#00BD9D]/20 focus:border-[#00BD9D] transition-all text-gray-700"
        />
        <SearchIcon
          class="w-6 h-6 text-[#FF7F11] absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none"
        />
      </div>

      <div
        id="filterButtons"
        class="flex flex-wrap items-center gap-3 w-full lg:w-2/3 justify-center lg:justify-end"
      >
        {
          filterOptions.map((option, index) => (
            <button
              class={`rounded-full shadow-sm hover:bg-[#FF7F11] hover:text-white hover:border-[#FF7F11] transition-all duration-200 ease-in-out transform hover:-translate-y-0.5 flex items-center justify-center fade-in-up cursor-pointer filter-button
            ${option.isImage ? "bg-emerald-50 border-emerald-200 border w-22 h-10 py-1 px-2" : "bg-emerald-50 text-[#00BD9D] text-sm font-semibold border border-emerald-200 px-4 py-2"}
          `}
              data-animate
              style={`transition-delay: ${0.3 + index * 0.1}s;`}
              data-category={option.value}
            >
              {option.isImage ? (
                <img
                  src={option.imageSrc.src}
                  alt={option.name}
                  class={`max-h-full max-w-full object-contain
                    ${option.value === "Ricocan" ? "scale-175" : ""}
                  `}
                />
              ) : (
                option.icon && <option.icon class="w-5 h-5 mr-1" />
              )}
              {!option.isImage && option.name}
            </button>
          ))
        }
      </div>
    </div>

    <!-- Productos -->
    <div
      id="productsContainer"
      class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8"
    >
      {
        products.map((product, index) => {
          return (
            <div
              class="flex justify-center items-center zoom-in product-item"
              style={`transition-delay: ${0.1 + index * 0.08}s;`}
              data-category={product.category}
              data-name={product.name.toLowerCase()}
            >
              <CardProduct product={product} />
            </div>
          );
        })
      }
    </div>
  </div>
</section>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const searchInput = document.getElementById(
      "searchInput"
    ) as HTMLInputElement;
    const filterButtons = document.querySelectorAll(
      ".filter-button"
    ) as NodeListOf<HTMLButtonElement>;
    const productItems = document.querySelectorAll(
      ".product-item"
    ) as NodeListOf<HTMLElement>;

    let currentSearchTerm = "";
    let currentCategory = "all";

    function filterProducts() {
      productItems.forEach((item) => {
        const productName = item.dataset.name || "";
        const productCategory = item.dataset.category || "";

        const matchesSearch = productName.includes(
          currentSearchTerm.toLowerCase()
        );
        const matchesCategory =
          currentCategory === "all" || productCategory === currentCategory;

        if (matchesSearch && matchesCategory) {
          item.style.display = "flex";
        } else {
          item.style.display = "none";
        }
      });
    }

    searchInput.addEventListener("input", () => {
      currentSearchTerm = searchInput.value;
      filterProducts();
    });

    // Eventos para los botones de categoría
    filterButtons.forEach((button) => {
      button.addEventListener("click", () => {
        // Limpia todos los botones: Desactiva el que estaba activo y activa el resto como inactivos.
        filterButtons.forEach((btn) => {
          btn.classList.remove(
            "bg-[#FF7F11]",
            "text-white",
            "border-[#FF7F11]"
          ); // Quita activo
          btn.classList.add(
            "bg-emerald-50",
            "text-[#00BD9D]",
            "border-emerald-200"
          ); // Añade inactivo
        });

        // Activa el botón clickeado:
        button.classList.remove(
          "bg-emerald-50",
          "text-[#00BD9D]",
          "border-emerald-200"
        );
        button.classList.add("bg-[#FF7F11]", "text-white", "border-[#FF7F11]");

        currentCategory = button.dataset.category || "";
        filterProducts();
      });
    });

    // siempre que se cargue la página, se activa el filtro "Todo" por defecto
    const allButton = document.querySelector(
      '[data-category="all"]'
    ) as HTMLButtonElement | null;
    if (allButton) {
      // quitamos las clases de inactivo por si acaso
      allButton.classList.remove(
        "bg-emerald-50",
        "text-[#00BD9D]",
        "border-emerald-200"
      );
      allButton.classList.add("bg-[#FF7F11]", "text-white", "border-[#FF7F11]");
    }
  });
</script>
